<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Cardio">
    <meta name="theme-color" content="#1a1a2e">
    <title>Cardio Challenge</title>
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="https://greenrabite.github.io/cardio/icon.png">
    <link rel="icon" type="image/png" href="https://greenrabite.github.io/cardio/icon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            color: white;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        .cards {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            max-width: 400px;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 28px 24px;
            text-decoration: none;
            color: white;
            display: flex;
            align-items: center;
            gap: 20px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card:active {
            transform: scale(0.98);
        }

        .card-icon {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            flex-shrink: 0;
        }

        .card-tracker .card-icon {
            background: linear-gradient(135deg, #4ade80, #22c55e);
        }

        .card-log .card-icon {
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
        }

        .card-content h2 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .card-content p {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
            line-height: 1.4;
        }

        .card-arrow {
            margin-left: auto;
            font-size: 20px;
            color: rgba(255, 255, 255, 0.4);
        }

        .footer {
            margin-top: auto;
            padding-top: 40px;
            text-align: center;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.4);
        }

        @media (hover: hover) {
            .card:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                border-color: rgba(255, 255, 255, 0.2);
            }
        }

        /* Standings Section */
        .standings  {
            width: 100%;
            max-width: 400px;
            margin-top: 24px;
        }

        .standings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .standings-header h2 {
            font-size: 18px;
            font-weight: 600;
        }

        .standings-header button {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: rgba(255, 255, 255, 0.6);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
        }

        .standings-header button:active {
            background: rgba(255, 255, 255, 0.2);
        }

        .standings-list {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .standings-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        .standings-table th,
        .standings-table td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Fixed column widths */
        .standings-table th:nth-child(1),
        .standings-table td:nth-child(1) { width: 35%; }
        .standings-table th:nth-child(2),
        .standings-table td:nth-child(2) { width: 15%; }
        .standings-table th:nth-child(3),
        .standings-table td:nth-child(3) { width: 17%; }
        .standings-table th:nth-child(4),
        .standings-table td:nth-child(4) { width: 15%; }
        .standings-table th:nth-child(5),
        .standings-table td:nth-child(5) { width: 18%; }

        .standings-table th {
            font-size: 11px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .standings-table td:first-child,
        .standings-table th:first-child {
            text-align: left;
            padding-left: 16px;
        }

        .standings-table td:last-child,
        .standings-table th:last-child {
            padding-right: 16px;
        }

        .standings-table tbody tr:last-child td {
            border-bottom: none;
        }

        .standing-name {
            font-size: 14px;
            font-weight: 500;
        }

        .standing-miles {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
        }

        .standing-miles.zero {
            color: rgba(255, 255, 255, 0.3);
        }

        .standing-percent {
            font-size: 14px;
            font-weight: 600;
        }

        .standings-loading, .standings-error {
            padding: 24px;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 14px;
        }

        .standings-error {
            color: #f87171;
        }

        /* Combined Table */
        .combined-section {
            width: 100%;
            max-width: 400px;
            margin-top: 16px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Cardio Challenge</h1>
        <p>February 2026</p>
    </div>

    <div class="cards">
        <a href="https://docs.google.com/spreadsheets/u/1/d/1FqFJqc9eYzOLVMbT0EGwMr13EDYr_lEOKQhDlptkldQ/edit?gid=0#gid=0" class="card card-tracker">
            <div class="card-icon">üìä</div>
            <div class="card-content">
                <h2>View Tracker</h2>
                <p>Check standings and weekly progress</p>
            </div>
            <span class="card-arrow">‚Ä∫</span>
        </a>

        <a href="https://forms.gle/7K6EH5aNPKMWc7e59" class="card card-log">
            <div class="card-icon">‚úèÔ∏è</div>
            <div class="card-content">
                <h2>Log Activity</h2>
                <p>Record your run, swim, or bike</p>
            </div>
            <span class="card-arrow">‚Ä∫</span>
        </a>
    </div>

    <div class="standings">
        <div class="standings-header">
            <h2>Week 1 Standings</h2>
            <button onclick="loadStandings()">Refresh</button>
        </div>
        <div class="standings-list" id="standings-list">
            <div class="standings-loading">Loading standings...</div>
        </div>
    </div>

    <div class="combined-section">
        <div class="standings-list" id="combined-list"></div>
    </div>

    <div class="footer">
        <p>Add to Home Screen for quick access</p>
    </div>

    <script>
        const SHEET_ID = '1FqFJqc9eYzOLVMbT0EGwMr13EDYr_lEOKQhDlptkldQ';
        const SHEET_GID = '0';
        
        // Returns a color from red (0%) to green (100%)
        function getPercentColor(percent) {
            // Clamp percent between 0 and 1
            const p = Math.max(0, Math.min(1, percent));
            // Red: #ef4444 (239, 68, 68), Green: #22c55e (34, 197, 94)
            const r = Math.round(239 + (34 - 239) * p);
            const g = Math.round(68 + (197 - 68) * p);
            const b = Math.round(68 + (94 - 68) * p);
            return `rgb(${r}, ${g}, ${b})`;
        }
        
        async function loadStandings() {
            const container = document.getElementById('standings-list');
            const combinedContainer = document.getElementById('combined-list');
            container.innerHTML = '<div class="standings-loading">Loading standings...</div>';
            combinedContainer.innerHTML = '';
            
            try {
                // Fetch data using Google Visualization API (requires sheet to be published)
                const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${SHEET_GID}`;
                const response = await fetch(url);
                const text = await response.text();
                
                // Parse the JSONP-like response
                const jsonString = text.match(/google\.visualization\.Query\.setResponse\(([\s\S]*)\);?/);
                if (!jsonString) {
                    throw new Error('Could not parse response. Make sure the sheet is published to web.');
                }
                
                const data = JSON.parse(jsonString[1]);
                const rows = data.table.rows;
                
                // Sheet structure (Week 1 columns):
                // A(0)=Name, B(1)=Email, C(2)=Run, D(3)=Swim, E(4)=Bike, F(5)=Percentage
                // Row 0 is header, rows 1+ are participants
                const participants = [];
                let combined = null;
                
                for (let i = 1; i < rows.length; i++) {
                    if (rows[i] && rows[i].c && rows[i].c[0]) {
                        const row = rows[i].c;
                        const name = row[0]?.v || '';
                        const run = parseFloat(row[2]?.v) || 0;
                        const swim = parseFloat(row[3]?.v) || 0;
                        const bike = parseFloat(row[4]?.v) || 0;
                        const percent = parseFloat(row[5]?.v) || 0;
                        
                        // Capture Combined row
                        if (name === 'Combined') {
                            combined = { name, run, swim, bike, percent };
                            continue;
                        }
                        
                        // Skip non-participant rows
                        const skipNames = ['Log Your Activity', 'Log Your Acitivity', ''];
                        if (name && !skipNames.includes(name)) {
                            participants.push({ name, run, swim, bike, percent });
                        }
                    }
                }
                
                // Sort by percentage descending, then alphabetically by name
                participants.sort((a, b) => {
                    if (b.percent !== a.percent) return b.percent - a.percent;
                    return a.name.localeCompare(b.name);
                });
                
                // Render standings table
                let html = `
                    <table class="standings-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>üèÉ</th>
                                <th>üèä</th>
                                <th>üö¥</th>
                                <th>%</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                participants.forEach((p) => {
                    const runClass = p.run > 0 ? '' : 'zero';
                    const swimClass = p.swim > 0 ? '' : 'zero';
                    const bikeClass = p.bike > 0 ? '' : 'zero';
                    
                    html += `
                        <tr>
                            <td class="standing-name">${p.name}</td>
                            <td class="standing-miles ${runClass}">${p.run.toFixed(1)}</td>
                            <td class="standing-miles ${swimClass}">${p.swim.toFixed(2)}</td>
                            <td class="standing-miles ${bikeClass}">${p.bike.toFixed(1)}</td>
                            <td class="standing-percent" style="color: ${getPercentColor(p.percent)}">${(p.percent * 100).toFixed(0)}%</td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                
                container.innerHTML = html || '<div class="standings-error">No data found</div>';
                
                // Render combined table
                if (combined) {
                    const runClass = combined.run > 0 ? '' : 'zero';
                    const swimClass = combined.swim > 0 ? '' : 'zero';
                    const bikeClass = combined.bike > 0 ? '' : 'zero';
                    
                    combinedContainer.innerHTML = `
                        <table class="standings-table">
                            <tbody>
                                <tr>
                                    <td class="standing-name">${combined.name}</td>
                                    <td class="standing-miles ${runClass}">${combined.run.toFixed(1)}</td>
                                    <td class="standing-miles ${swimClass}">${combined.swim.toFixed(2)}</td>
                                    <td class="standing-miles ${bikeClass}">${combined.bike.toFixed(1)}</td>
                                    <td class="standing-percent" style="color: ${getPercentColor(combined.percent)}">${(combined.percent * 100).toFixed(0)}%</td>
                                </tr>
                            </tbody>
                        </table>
                    `;
                }
                
            } catch (error) {
                console.error('Error loading standings:', error);
                container.innerHTML = `
                    <div class="standings-error">
                        Unable to load standings.<br>
                        <small>Sheet must be published to web:<br>
                        File ‚Üí Share ‚Üí Publish to web</small>
                    </div>
                `;
            }
        }
        
        // Load standings on page load
        loadStandings();
        
        // Register service worker for offline support and auto-updates
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(() => console.log('Service worker registered'))
                .catch((err) => console.log('Service worker registration failed:', err));
        }
    </script>
</body>
</html>
